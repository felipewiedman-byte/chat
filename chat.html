<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Chat Real - Radio Comunidad</title>
<style>
:root {
  --youtube-red: rgba(255, 0, 0, 0.8);
  --twitch-purple: rgba(100, 65, 165, 0.8);
  --kick-green: rgba(0, 200, 0, 0.8);
  --chat-width: 380px;
  --message-max-width: 360px;
}

* { margin: 0; padding: 0; box-sizing: border-box; }

body {
  margin: 0;
  padding: 0;
  overflow: hidden;
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
  background: transparent !important;
  user-select: none;
  width: 100vw;
  height: 100vh;
  position: relative;
}

#chat-overlay {
  position: absolute;
  bottom: 20px;
  left: 20px;
  width: var(--chat-width);
  display: flex;
  flex-direction: column;
  align-items: flex-start;
  pointer-events: none;
  z-index: 999999;
  padding: 0;
  background: transparent;
  gap: 0;
}

.live-stats-container {
  width: 100%;
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 8px 12px;
  background: rgba(0,0,0,0.85);
  border-radius: 8px;
  border: 1px solid rgba(255,255,255,0.15);
  margin-bottom: 10px;
}

.stats-section { display: flex; flex-direction: column; gap: 2px; }
.stats-label { font-size: 9px; color: rgba(255,255,255,0.7); font-weight:600; text-transform: uppercase; }
.stats-value { font-size:14px; font-weight:800; color:#fff; display:flex; align-items:center; gap:4px; }
.stats-icon { font-size:12px; margin-right:3px; }
.stats-divider { width:1px; height:20px; background: rgba(255,255,255,0.3); margin:0 8px; }

#message-container {
  width: 100%;
  display: flex;
  flex-direction: column;
  gap: 5px;
  overflow-y: auto;
  max-height: 450px;
  padding: 12px 12px 8px 12px;
  background: transparent;
}

#message-container::-webkit-scrollbar { display: none; }

.chat-card {
  display:flex;
  align-items:flex-start;
  gap:8px;
  padding:8px 12px;
  border-radius:6px;
  color:#fff;
  font-size:13px;
  width:100%;
  max-width: var(--message-max-width);
  background: rgba(25,25,25,0.85);
  border:1px solid rgba(255,255,255,0.1);
  animation: messageSlideIn 0.2s cubic-bezier(0.21,0.61,0.35,1) forwards;
}

@keyframes messageSlideIn {
  0% { opacity:0; transform:translateX(-15px) scale(0.98); }
  100% { opacity:1; transform:translateX(0) scale(1); }
}

.youtube { background: rgba(255,0,0,0.1); border-left:3px solid #FF0000; }
.twitch  { background: rgba(100,65,165,0.1); border-left:3px solid #6441a5; }
.kick    { background: rgba(0,200,0,0.1); border-left:3px solid #00c800; }

#events-container {
  position: absolute;
  bottom: 620px;  /* Posicionado encima del chat */
  left: 20px;
  width: 380px;
  pointer-events: none;
  z-index: 1000000;
}

.event-window {
  width: 100%;
  min-height: 75px;
  background: rgba(0,0,0,0.95);
  border-radius: 10px;
  border:1px solid rgba(255,255,255,0.2);
  padding:12px;
  margin-bottom:10px;
  position:relative;
  animation: slideInDown 0.5s cubic-bezier(0.21,0.61,0.35,1);
  box-shadow: 0 5px 15px rgba(0,0,0,0.5);
}

@keyframes slideInDown {
  0% { opacity:0; transform: translateY(-20px); }
  100% { opacity:1; transform: translateY(0); }
}

.event-header { display:flex; align-items:center; gap:8px; margin-bottom:8px; }
.event-icon { width:30px; height:30px; display:flex; align-items:center; justify-content:center; font-size:16px; border-radius:6px; }
.event-title { font-size:14px; font-weight:800; color:#fff; text-transform:uppercase; }
.event-body { display:flex; align-items:center; gap:12px; }
.event-user-avatar { width:40px; height:40px; border-radius:8px; flex-shrink:0; display:flex; align-items:center; justify-content:center; font-weight:bold; font-size:16px; color:#fff; border:2px solid rgba(255,255,255,0.3); }
.event-details { flex:1; }
.event-user-name { font-size:14px; font-weight:800; color:#fff; margin-bottom:3px; }
.event-description { font-size:12px; color:#fff; line-height:1.3; }
.event-timer { position:absolute; bottom:0; left:0; width:100%; height:4px; background: rgba(255,255,255,0.1); }
.event-progress { height:100%; background: linear-gradient(90deg,#FFD700,#FFA500); animation: progressShrink 5s linear forwards; }

@keyframes progressShrink { 0%{width:100%;} 100%{width:0;} }

.floating-emoji {
  position: fixed;
  font-size:32px;
  pointer-events:none;
  z-index:1000001;
  animation: floatUp 3s ease-out forwards;
}

@keyframes floatUp {
  0% { opacity:1; transform:translateY(0) rotate(0deg) scale(1);}
  50% { opacity:0.9; transform:translateY(-50px) rotate(180deg) scale(1.3);}
  100% { opacity:0; transform:translateY(-100px) rotate(360deg) scale(1.5);}
}
</style>
</head>
<body>

<div id="events-container"></div>

<div id="chat-overlay">
  <div class="live-stats-container">
    <div class="stats-section">
      <div class="stats-label">Conectados</div>
      <div class="stats-value"><span class="stats-icon">üë•</span><span id="connected-count">847</span></div>
    </div>
    <div class="stats-divider"></div>
    <div class="stats-section">
      <div class="stats-label">Likes</div>
      <div class="stats-value"><span class="stats-icon">‚ù§Ô∏è</span><span id="live-likes">723</span></div>
    </div>
    <div class="stats-divider"></div>
    <div class="stats-section">
      <div class="stats-label">Mensajes</div>
      <div class="stats-value"><span class="stats-icon">üí¨</span><span id="total-messages">0</span></div>
    </div>
    <div class="stats-divider"></div>
    <div class="stats-section">
      <div class="stats-label">Activos</div>
      <div class="stats-value"><span class="stats-icon">‚úçÔ∏è</span><span id="typing-count">12</span></div>
    </div>
  </div>

  <div id="message-container"></div>
</div>

<script>
// === LECTOR EXACTO DEL TXT - ACTUALIZACI√ìN CADA MINUTO CON FLUJO CONSTANTE ===
(function() {
  const TXT_URL = 'https://raw.githubusercontent.com/felipewiedman-byte/textos_del_chat/refs/heads/main/textos_del_chat.txt';
  
  let mensajesChat = [];
  let eventos = [];
  let emojis = ['‚ù§Ô∏è', 'üî•', 'üéâ', '‚ú®', '‚ö°', 'üåü'];
  let indiceMensaje = 0;
  let indiceEvento = 0;
  let ultimosMensajesVistos = new Set();
  
  // üî¥ TODOS LOS VALORES INICIALES
  let conectadosActual = 847;
  let likesActual = 723;
  let mensajesTotal = 0;
  let activosActual = 12;
  
  const messageContainer = document.getElementById('message-container');
  const eventsContainer = document.getElementById('events-container');
  
  const platforms = ['youtube', 'twitch', 'kick'];
  const platformColors = { youtube: '#FF0000', twitch: '#6441a5', kick: '#00c800' };
  const platformCode = { youtube: 'YT', twitch: 'TW', kick: 'KC' };
  
  // Mensaje de carga inicial
  messageContainer.innerHTML = '<div class="chat-card youtube"><div style="width:28px;height:28px;border-radius:4px;background:#FF0000;display:flex;align-items:center;justify-content:center;">üì°</div><div><span style="font-weight:800;">Sistema</span> <span>Cargando chat...</span></div></div>';
  
  // üî¥ FUNCI√ìN PARA FORMATEAR N√öMEROS
  function formatearNumero(num) {
    return num > 999 ? (num/1000).toFixed(1) + 'K' : num;
  }
  
  // Funci√≥n para cargar el TXT completo
  function cargarTXT() {
    return fetch(TXT_URL + '?t=' + Date.now())
      .then(r => r.ok ? r.text() : Promise.reject('Error al cargar TXT'))
      .then(data => {
        const lineas = data.split('\n');
        let seccionActual = '';
        let nuevosMensajes = [];
        let nuevosEventos = [];
        let mensajesActualizados = [];
        
        lineas.forEach(linea => {
          linea = linea.trim();
          if (!linea) return;
          
          if (linea.includes('=== CONVERSACIONES ===')) {
            seccionActual = 'conversaciones';
            return;
          }
          if (linea.includes('=== EVENTOS ===')) {
            seccionActual = 'eventos';
            return;
          }
          if (linea.includes('=== EMOTICONOS FLOTANTES ===')) {
            seccionActual = 'emojis';
            return;
          }
          
          if (linea.startsWith('//')) return;
          
          if (seccionActual === 'conversaciones') {
            const match = linea.match(/^\[([^\]]+)\]\s*(.+)$/);
            if (match) {
              const msg = {
                user: match[1].trim(),
                texto: match[2].trim()
              };
              mensajesActualizados.push(msg);
              
              const id = match[1].trim() + '|' + match[2].trim();
              if (!ultimosMensajesVistos.has(id)) {
                ultimosMensajesVistos.add(id);
                nuevosMensajes.push(msg);
                mensajesTotal++;
              }
            }
          }
          else if (seccionActual === 'eventos' && linea.startsWith('!')) {
            if (!ultimosMensajesVistos.has('evento|' + linea)) {
              ultimosMensajesVistos.add('evento|' + linea);
              nuevosEventos.push(linea);
            }
          }
          else if (seccionActual === 'emojis' && linea.startsWith('#emojis')) {
            const nuevosEmojis = linea.replace('#emojis', '').trim().split(/\s+/);
            if (nuevosEmojis.length > 0) emojis = nuevosEmojis;
          }
        });
        
        mensajesChat = mensajesActualizados;
        document.getElementById('total-messages').innerText = formatearNumero(mensajesTotal);
        
        // Mostrar eventos NUEVOS
        if (nuevosEventos.length > 0) {
          console.log('Mostrando evento nuevo:', nuevosEventos[0]);
          mostrarEvento(nuevosEventos[0]);
        }
        
        // Limpiar conjunto si es necesario
        if (ultimosMensajesVistos.size > 1000) {
          const ids = Array.from(ultimosMensajesVistos);
          ultimosMensajesVistos = new Set(ids.slice(-500));
        }
        
        console.log(`Cargados ${mensajesChat.length} mensajes totales, ${nuevosMensajes.length} nuevos`);
        return mensajesChat;
      })
      .catch(error => {
        console.error('Error:', error);
        return [];
      });
  }
  
  function mostrarMensaje(msg) {
    const platform = platforms[Math.floor(Math.random() * platforms.length)];
    
    messageContainer.insertAdjacentHTML('beforeend', 
      '<div class="chat-card ' + platform + '">' +
      '<div style="width:28px;height:28px;border-radius:4px;background:' + platformColors[platform] + ';display:flex;align-items:center;justify-content:center;font-size:16px;">' + platformCode[platform] + '</div>' +
      '<div style="flex:1;"><span style="font-weight:800;">' + msg.user + '</span> <span style="color:rgba(255,255,255,0.8);">' + msg.texto + '</span></div>' +
      '</div>'
    );
    
    while (messageContainer.children.length > 15) {
      messageContainer.removeChild(messageContainer.children[0]);
    }
    messageContainer.scrollTop = messageContainer.scrollHeight;
  }
  
  function mostrarEvento(evento) {
    const parts = evento.substring(1).split(' ');
    const tipo = parts[0];
    let user = parts.length > 1 ? parts[1] : 'Alguien';
    let descripcion = parts.slice(2).join(' ') || 'interactu√≥ con el stream';
    
    user = user.replace('@', '');
    
    let titulo = 'üîî EVENTO';
    let icono = 'üîî';
    
    if (tipo === 'subscription') { titulo = 'üéÅ NUEVA SUSCRIPCI√ìN'; icono = 'üéÅ'; }
    else if (tipo === 'gift') { titulo = 'üéÅ SUSCRIPCI√ìN REGALADA'; icono = 'üéÅ'; }
    else if (tipo === 'donation') { titulo = 'üí∞ DONACI√ìN'; icono = 'üí∞'; }
    else if (tipo === 'raid') { titulo = 'üë• RAID'; icono = 'üë•'; }
    else if (tipo === 'bit') { titulo = 'üíé BITS'; icono = 'üíé'; }
    else if (tipo === 'host') { titulo = 'üé¨ HOST'; icono = 'üé¨'; }
    
    const platform = platforms[Math.floor(Math.random() * platforms.length)];
    
    // Mostrar el evento
    eventsContainer.innerHTML = 
      '<div class="event-window">' +
      '<div class="event-header">' +
      '<div class="event-icon" style="background:' + platformColors[platform] + ';">' + icono + '</div>' +
      '<span class="event-title">' + titulo + '</span>' +
      '</div>' +
      '<div class="event-body">' +
      '<div class="event-user-avatar" style="background:' + platformColors[platform] + ';">' + user.charAt(0).toUpperCase() + '</div>' +
      '<div class="event-details">' +
      '<div class="event-user-name">' + user + '</div>' +
      '<div class="event-description">' + descripcion + '</div>' +
      '</div>' +
      '</div>' +
      '<div class="event-timer"><div class="event-progress"></div></div>' +
      '</div>';
    
    // Ocultar despu√©s de 5 segundos
    setTimeout(() => { 
      if (eventsContainer.children[0]) {
        eventsContainer.innerHTML = ''; 
      }
    }, 5000);
  }
  
  // === CONTADORES DIN√ÅMICOS ===
  function moverContador(valorActual, elementoId) {
    const variacion = Math.floor(Math.random() * 80) - 40;
    valorActual += variacion;
    
    if (valorActual < 60) valorActual = 60;
    if (valorActual > 1200) valorActual = 1200;
    
    document.getElementById(elementoId).innerText = formatearNumero(valorActual);
    
    setTimeout(() => {
      if (elementoId === 'connected-count') {
        conectadosActual = moverContador(valorActual, elementoId);
      } 
      else if (elementoId === 'live-likes') {
        likesActual = moverContador(valorActual, elementoId);
      } 
      else if (elementoId === 'typing-count') {
        activosActual = moverContador(valorActual, elementoId);
      }
    }, 2000 + Math.random() * 4000);
    
    return valorActual;
  }
  
  // === INICIALIZACI√ìN ===
  
  // Carga inicial
  cargarTXT().then(() => {
    // Mostrar √∫ltimos 5 mensajes
    const inicio = Math.max(0, mensajesChat.length - 5);
    messageContainer.innerHTML = '';
    for (let i = inicio; i < mensajesChat.length; i++) {
      if (mensajesChat[i]) {
        mostrarMensaje(mensajesChat[i]);
      }
    }
    indiceMensaje = mensajesChat.length;
  });
  
  // Mostrar mensajes cada 4 segundos
  setInterval(() => {
    if (mensajesChat.length > 0) {
      const msg = mensajesChat[indiceMensaje % mensajesChat.length];
      mostrarMensaje(msg);
      indiceMensaje++;
    }
  }, 4000);
  
  // Recargar TXT cada minuto
  setInterval(() => {
    console.log('Recargando TXT...');
    cargarTXT();
  }, 60000);
  
  // Eventos de prueba cada 30 segundos (si no hay eventos en el TXT)
  setInterval(() => {
    if (eventos.length === 0) {
      // Evento de demostraci√≥n para probar que se ve
      const eventosDemo = [
        '!subscription @Streamer',
        '!donation @Usuario 10‚Ç¨',
        '!raid @Comunidad 50 espectadores'
      ];
      mostrarEvento(eventosDemo[Math.floor(Math.random() * eventosDemo.length)]);
    }
  }, 30000);
  
  // Emojis flotantes
  setInterval(() => {
    if (Math.random() > 0.6 && emojis.length > 0) {
      const e = document.createElement('div');
      e.className = 'floating-emoji';
      e.innerText = emojis[Math.floor(Math.random() * emojis.length)];
      e.style.left = Math.random() * 80 + 10 + '%';
      e.style.bottom = '20px';
      document.body.appendChild(e);
      setTimeout(() => e.remove(), 3000);
    }
  }, 4000);
  
  // Iniciar contadores
  moverContador(conectadosActual, 'connected-count');
  moverContador(likesActual, 'live-likes');
  moverContador(activosActual, 'typing-count');
  
})();
</script>

</body>
</html>
